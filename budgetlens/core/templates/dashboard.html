{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/dashboard.css' %}">
<div class="dashboard-container">
<h2>Dashboard</h2>

<div class="summary-cards" style="display: flex; justify-content: space-around; margin-bottom: 20px;">
    <div class="card" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px; width: 30%;">
        <h3>Total Income</h3>
        <p style="font-size: 1.5em; font-weight: bold;">{{ total_income }} {{ user.userprofile.target_currency }}</p>
    </div>
    <div class="card" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px; width: 30%;">
        <h3>Total Expenses</h3>
        <p style="font-size: 1.5em; font-weight: bold;">{{ total_expenses }} {{ user.userprofile.target_currency }}</p>
    </div>
    <div class="card" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px; width: 30%;">
        <h3>Balance</h3>
        <p style="font-size: 1.5em; font-weight: bold;">{{ balance|floatformat:2 }} {{ user.userprofile.target_currency }}</p>
    </div>
</div>

{% if amounts|length > 0 %}
<div style="width: 100%; max-width: 600px; height: 400px; margin: auto;">
    <canvas id="expensesChart"></canvas>
</div>
{% else %}
    <p>No expenses to display.</p>
{% endif %}

<div class="tabs" style="margin-top: 20px;">
    <div class="tab-buttons" style="display: flex; margin-bottom: 10px;">
        <button id="expenses-tab" class="tab-button active" style="flex: 1; padding: 10px; cursor: pointer; background-color: #f0f0f0; border: 1px solid #ddd;">Expenses</button>
        <button id="income-tab" class="tab-button" style="flex: 1; padding: 10px; cursor: pointer; background-color: #f0f0f0; border: 1px solid #ddd;">Income</button>
    </div>
    
    <div id="expenses-content" class="tab-content" style="display: block;">
        <h3>Recent Expenses</h3>
        <div style="max-height: 400px; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>Currency</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                    <tr onclick="window.location.href='{% url 'expense' expense.id %}'"
                        style="cursor: pointer;">
                        <td>{{ expense.category }}</td>
                        <td>{{ expense.amount }}</td>
                        <td>{{ expense.currency }}</td>
                        <td>{{ expense.expense_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div id="income-content" class="tab-content" style="display: none;">
        <h3>Recent Income</h3>
        <div style="max-height: 400px; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Currency</th>
                        <th>Date</th>
                        <th>Category</th>
                    </tr>
                </thead>
                <tbody>
                    {% for income in incomes %}
                    <tr onclick="window.location.href='{% url 'income_detail' income.id %}'"
                        style="cursor: pointer;">
                        <td>{{ income.description }}</td>
                        <td>{{ income.amount }}</td>
                        <td>{{ income.currency }}</td>
                        <td>{{ income.income_date }}</td>
                        <td>{{ income.category }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Script to render the chart -->
<script>
    var ctx = document.getElementById('expensesChart').getContext('2d');
    var expensesChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: {{ categories|safe }},
            datasets: [{
                data: {{ amounts|safe }},
                backgroundColor: [
                    '#FF6384',
                    '#36A2EB',
                    '#FFCE56',
                    '#4BC0C0',
                    '#9966FF',
                    '#FF9F40',
                ],
                hoverBackgroundColor: [
                    '#FF6384',
                    '#36A2EB',
                    '#FFCE56',
                    '#4BC0C0',
                    '#9966FF',
                    '#FF9F40',
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                title: {
                    display: true,
                    text: 'Expenses by Category'
                }
            }
        }
    });
    
    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', function() {
        const expensesTab = document.getElementById('expenses-tab');
        const incomeTab = document.getElementById('income-tab');
        const expensesContent = document.getElementById('expenses-content');
        const incomeContent = document.getElementById('income-content');
        
        expensesTab.addEventListener('click', function() {
            expensesTab.classList.add('active');
            incomeTab.classList.remove('active');
            expensesContent.style.display = 'block';
            incomeContent.style.display = 'none';
        });
        
        incomeTab.addEventListener('click', function() {
            incomeTab.classList.add('active');
            expensesTab.classList.remove('active');
            incomeContent.style.display = 'block';
            expensesContent.style.display = 'none';
        });
    });
</script>
</div>
{% endblock %}